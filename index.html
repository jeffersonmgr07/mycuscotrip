<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyCuscoTrip - Tours y Paquetes Tur√≠sticos en Cusco y Machu Picchu</title>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  
  <!-- Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.css"/>

  <!-- Estilos con rutas relativas -->
  <link rel="stylesheet" href="./assets/css/main.css">
  <link rel="stylesheet" href="./assets/css/components.css">
  <link rel="stylesheet" href="./assets/css/header.css">
  <link rel="stylesheet" href="./assets/css/footer.css">
  <link rel="stylesheet" href="./assets/css/search-bar.css">
  <link rel="stylesheet" href="./assets/css/products.css">
  <link rel="stylesheet" href="./assets/css/responsive.css">
</head>

<body>
  <!-- Header (se cargar√° din√°micamente) -->
  <div id="header-container"></div>

  <!-- WhatsApp flotante (m√≥vil) -->
  <a class="wa-float" href="https://wa.me/51900608980" target="_blank" rel="noopener" aria-label="WhatsApp">
    <img src="./assets/img/logos/LogoWhatsapp.png" alt="WhatsApp" />
  </a>

  <!-- Hero -->
  <section class="hero" id="home">
    <div class="hero-media" aria-hidden="true">
      <!-- Video placeholder - puedes agregar videos despu√©s -->
        <video
        class="hero-video hero-video-desktop"
        autoplay
        muted
        loop
        playsinline
      >
        <source src="assets/videos/hero.mp4" type="video/mp4">
      </video>
  
      <video
        class="hero-video hero-video-mobile"
        autoplay
        muted
        loop
        playsinline
      >
        <source src="assets/videos/hero-movil.mp4" type="video/mp4">
      </video>
  
      <!-- Overlay oscuro -->
      <div class="hero-overlay"></div>
      <div style="width:100%;height:100%;background:linear-gradient(rgba(6,40,3,.8),rgba(5,50,32,.9));"></div>
    </div>

    <div class="container">
      <div class="hero-content">
        <div class="hero-text">
          <h2>¬øPlanes para<br><span>Machu Picchu?</span></h2>
          <h2>encuentra el plan perfecto aqu√≠</h2>
        </div>

        <!-- Componente Search Bar -->
        <div id="search-bar-container"></div>
      </div>
    </div>
  </section>

  <!-- MODAL OVERLAY PARA COMPONENTES (M√ìVILES) -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content" id="modalContent"></div>
  </div>

  <!-- Secci√≥n de Destinos -->
  <section id="machu-picchu">
    <div class="container">
      <div class="section-header">
        <h2>Machu Picchu</h2>
        <p>Descubre la maravilla del mundo moderno con nuestros tours exclusivos</p>
      </div>
      <div class="destinos-grid" id="products-container">
        <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
      </div>
    </div>
  </section>

  <!-- Footer (se cargar√° din√°micamente) -->
  <div id="footer-container"></div>

  <!-- Scripts EXTERNOS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.js"></script>
  
  <!-- Script para cargar componentes din√°micamente - INLINE para evitar problemas de ruta -->
  <script>
    // Configuraci√≥n para GitHub Pages
    const IS_GITHUB_PAGES = window.location.hostname.includes('github.io');
    const BASE_PATH = IS_GITHUB_PAGES ? '/mycuscotrip/' : '/';
    
    console.log('üöÄ Configuraci√≥n:', { IS_GITHUB_PAGES, BASE_PATH });
    
    // Funci√≥n para cargar componentes
    async function loadComponent(componentName, targetId) {
      try {
        // Construir ruta correcta para GitHub Pages
        const componentPath = `${BASE_PATH}components/${componentName}.html`;
        console.log(`üìÅ Cargando: ${componentPath}`);
        
        const response = await fetch(componentPath);
        
        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }
        
        const html = await response.text();
        const target = document.getElementById(targetId);
        
        if (target) {
          target.innerHTML = html;
          console.log(`‚úÖ ${componentName} cargado en #${targetId}`);
          
          // Corregir rutas de im√°genes dentro del componente cargado
          fixImagePaths(target);
          
          return true;
        }
        
        return false;
        
      } catch (error) {
        console.error(`‚ùå Error cargando ${componentName}:`, error);
        
        // Mostrar contenido de fallback
        const target = document.getElementById(targetId);
        if (target) {
          target.innerHTML = getFallbackContent(componentName);
        }
        
        return false;
      }
    }
    
    // Corregir rutas de im√°genes
    function fixImagePaths(container) {
      const images = container.querySelectorAll('img[src*="assets/"]');
      images.forEach(img => {
        const currentSrc = img.getAttribute('src');
        if (currentSrc.startsWith('assets/')) {
          const newSrc = `.${currentSrc}`;
          img.setAttribute('src', newSrc);
          console.log(`üîÑ Ruta corregida: ${currentSrc} -> ${newSrc}`);
        }
      });
    }
    
    // Contenido de fallback si no se puede cargar un componente
    function getFallbackContent(componentName) {
      const fallbacks = {
        'header': `
          <header style="background:#053220;padding:15px 0;">
            <div class="container" style="display:flex;justify-content:space-between;align-items:center;">
              <div style="color:white;font-weight:bold;font-size:1.2rem;">MyCuscoTrip</div>
              <nav>
                <a href="#home" style="color:white;margin:0 10px;">Home</a>
                <a href="#machu-picchu" style="color:white;margin:0 10px;">Machu Picchu</a>
              </nav>
            </div>
          </header>
        `,
        'search-bar': `
          <div style="background:white;padding:20px;border-radius:10px;margin-top:20px;">
            <div style="text-align:center;color:#666;padding:20px;">
              Barra de b√∫squeda temporalmente no disponible
            </div>
          </div>
        `,
        'footer': `
          <footer style="background:#062803;color:white;padding:40px 0;margin-top:40px;">
            <div class="container">
              <div style="text-align:center;">
                <p>¬© 2023 MyCuscoTrip</p>
                <p>Especialistas en viajes a Cusco y Machu Picchu</p>
              </div>
            </div>
          </footer>
        `
      };
      
      return fallbacks[componentName] || `<div>Componente ${componentName} no disponible</div>`;
    }
    
    // Funci√≥n para inicializar componentes JS
    function initializeComponents() {
      console.log('üîÑ Inicializando componentes JS...');
      
      // Header
      if (typeof MyCuscoTripHeader === 'function') {
        try {
          new MyCuscoTripHeader();
          console.log('‚úÖ Header JS inicializado');
        } catch (e) {
          console.error('‚ùå Error en Header JS:', e);
        }
      }
      
      // SearchBar (necesita Flatpickr)
      if (typeof MyCuscoTripSearchBar === 'function' && typeof flatpickr !== 'undefined') {
        setTimeout(() => {
          try {
            new MyCuscoTripSearchBar();
            console.log('‚úÖ SearchBar JS inicializado');
          } catch (e) {
            console.error('‚ùå Error en SearchBar JS:', e);
          }
        }, 500);
      }
      
      // Products
      if (typeof MyCuscoTripProducts === 'function') {
        try {
          new MyCuscoTripProducts();
          console.log('‚úÖ Products JS inicializado');
        } catch (e) {
          console.error('‚ùå Error en Products JS:', e);
        }
      }
    }
    
    // Cargar e inicializar todo
    async function initializeApp() {
      console.log('üé¨ Iniciando aplicaci√≥n en GitHub Pages...');
      
      // Cargar componentes HTML
      await Promise.all([
        loadComponent('header', 'header-container'),
        loadComponent('search-bar', 'search-bar-container'),
        loadComponent('footer', 'footer-container')
      ]);
      
      // Inicializar JS despu√©s de cargar HTML
      setTimeout(initializeComponents, 300);
    }
    
    // Iniciar cuando est√© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
  
  <!-- Scripts de componentes (con rutas relativas) -->
  <script src="./assets/js/components/header.js"></script>
  <script src="./assets/js/components/search-bar.js"></script>
  <script src="./assets/js/components/products.js"></script>
  <!-- Despu√©s de los otros scripts -->
  <script src="./assets/js/lib/utils.js"></script>
  <script src="./assets/js/lib/flatpickr-config.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const desktopVideos = document.querySelectorAll(".hero-video-desktop");
    const mobileVideos = document.querySelectorAll(".hero-video-mobile");

    desktopVideos.forEach(v => v.playbackRate = 0.6);
    mobileVideos.forEach(v => v.playbackRate = 0.8);
  });
</script>
</body>
</html>
